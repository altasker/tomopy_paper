%------------------------------------------------------------------------------
% Template file for the submission of papers to IUCr journals in LaTeX2e
% using the iucr document class
% Copyright 1999-2013 International Union of Crystallography
% Version 1.6 (28 March 2013)
%------------------------------------------------------------------------------

\documentclass[pdf]{iucr}              % DO NOT DELETE THIS LINE
\usepackage{graphicx}
\usepackage{color}
\usepackage{ulem}

     %-------------------------------------------------------------------------
     % Information about journal to which submitted
     %-------------------------------------------------------------------------
     \journalcode{S}              % Indicate the journal to which submitted
                                  %   A - Acta Crystallographica Section A
                                  %   B - Acta Crystallographica Section B
                                  %   C - Acta Crystallographica Section C
                                  %   D - Acta Crystallographica Section D
                                  %   E - Acta Crystallographica Section E
                                  %   F - Acta Crystallographica Section F
                                  %   J - Journal of Applied Crystallography
                                  %   M - IUCrJ
                                  %   S - Journal of Synchrotron Radiation

\begin{document}                  % DO NOT DELETE THIS LINE

     %-------------------------------------------------------------------------
     % The introductory (header) part of the paper
     %-------------------------------------------------------------------------

     % The title of the paper. Use \shorttitle to indicate an abbreviated title
     % for use in running heads (you will need to uncomment it).

\title{TomoPy: A framework for the analysis of synchrotron tomographic data}
%\shorttitle{Short Title}

     % Authors' names and addresses. Use \cauthor for the main (contact) author.
     % Use \author for all other authors. Use \aff for authors' affiliations.
     % Use lower-case letters in square brackets to link authors to their
     % affiliations; if there is only one affiliation address, remove the [a].

\cauthor{Do\v{g}a}{G\"{u}rsoy}{dgursoy@aps.anl.gov}{} 
\author{Francesco}{De Carlo}
\author{?}{?}


\aff{Advanced Photon Source, Argonne National Laboratory, 9700 S.~Cass Ave., Argonne IL 60439-4837 \country{USA}}


     % Keywords (required for Journal of Synchrotron Radiation only)
     % Use the \keyword macro for each word or phrase, e.g. 
     % \keyword{X-ray diffraction}\keyword{muscle}

\keyword{tomopgraphy}
\keyword{x-ray imaging}
\keyword{phase retrieval}

\hyphenpenalty=10000

\maketitle                        % DO NOT DELETE THIS LINE

\begin{synopsis}
Supply a synopsis of the paper for inclusion in the Table of Contents.
\end{synopsis}

\begin{abstract}
Abstract goes here.
\end{abstract}


\section{Introduction}

Analysis of large tomographic datasets at synchrotron light sources is becoming progressively more challenging  due to the increasing data acquisition rates that new technologies in X-ray sources and detectors enable. The next generation of synchrotron facilities that are currently under design or construction throughout the world will provide diffraction limited X-ray sources and is expected to boost the current data rates by several orders of magnitude and stressing the need for the development and integration of efficient analysis tools more than ever. Several synchrotron users, to take advantage of specific instrument characteristics and specifications,  already collect data at different facilities, but they are often left alone integrating this data with the available or home-grown software tools.

There are often strong similarities within the same class of instruments that are not systematically utilized to build a coordinated software development platform or framework where each facility and user group can take advantage from or contribute in, ultimately saving on-site resources by sharing the computing tasks with the user community. Here we describe in detail an attempt to provide such a collaborative framework for the analysis of synchrotron tomographic data that has the potential to unify the effort of different facilities and beamlines performing similar tasks. The basic principles of this  Python/C++ based framework, called {\it TomopPy}, are: OS and data format independent, parallelizable, modular and supporting a functional programming style that many researchers in Academia prefer. 


\section{Background}

When it comes to the digital storage of tomographic experimental data and the development of analysis tools at synchrotron light sources around the world, the situation is very heterogeneous. As different research teams and instruments have grown at various facilities, they have often developed local data and analysis models based on instrument hardware specificity and often drawing upon the particular preferences of a scientist writing software. 

Many tomographic analysis tools utilize licensed, and often expensive, software packages like Matlab (Mathworks) and IDL (Exelis VIS), others rely on specific, and often complex to maintain, computing infrastructure like MPI-based CPU or GPU clusters. The availability of inexpensive multi-core CPU workstation and the reduced cost of computer memory  allowed to simplify the computing infrastructure required to process tomographic data \cite{rivers_spie_2012}, and started the development of single workstation tools able to perform most computing tasks. 

This transition is affecting all major synchrotron facilities where new effort is now dedicated into developing new tools that can be deployed at the facility for real time processing as well as distributed to users for off site data processing.


\section{TomoPy framework}

The differences between academia and industry. Mention common coding practices in Academia. People in Academia are leaned towards functional programming.

Modularity is favored. The overall effect of removing a module on the package is tried to be minimized.


Explain code structure. Functions and interfaces with the code-base. Touch Data Exchange and data converters (give a complete list of converters and how they can be implemented). Explain data domain module (preprocessing), data-to-image domain module (recon) and image domain module (post process). Mention about visualization (discuss about Mayavi, Avizo, Amira, etc.) and what is planned.

Put a diagram figure and explain throughly.

There are a number of viable options to to digest such high-throughput data and facilitate the computational analysis as a means of utilizing technological advancements. GPUs, CPUs and scalability.

GPU computing: The emergent computational potential of graphical processing units (GPUs) in the recent past has led to a great interest of research and development in ways to leverage GPUs for computationally intensive tasks. However, the memory of a single GPU is still not sufficiently large enough to digest large tomographic datasets without avoiding excessive input/output (I/O) overhead. 

CPU computing on dedicated workstations: Current trend in processor design is towards chips with multiple low-power consuming cores which leads to a new layer of sophistication in code development. More hands-on control over data and is preferable in terms of support and development projects.

Scalability with clusters of GPUs or CPUs. APS has  access to Mira, BNL uses NERSC. Others? Touch data transfer issues. Users have less control over data. Large computer-clusters generally require an efficient queuing optimization, computation times are highly correlated with the demand.  

Discuss input output formats. Mention ongoing attempts :Data Exchange.

We aim an open open source platform that everybody can contribute and install easily.

\section{Development}

Explain how anyone can contribute. How it is distributed. BSD License. Documentation.

\section{Methods} 

In synchrotron tomography, the imaging sample is placed in the beam path and the x-ray intensity profiles (also called tomograms or projections) are acquired by rotating the sample during x-ray exposure. Almost all data acquisition protocols require another set of data taken in the absence of the sample which is usually refereed to as the white-field (or flat-field) measurements. These two set of  measurement together with the rotation angle information is the entry point of the analysis pipeline.

The framework is divided into three main modules as given in figure~1.

Present here the concept of pipeline for data processing and distribution

\subsection{Pre-processing methods}

\subsubsection{Normalization}

The need for this acquisition is to compensate for the effect of optical components in the beam path which are superimposed on the projections and show up artifacts in reconstructed images. 

\subsubsection{Ring removal:}

The reconstruction quality can be dramatically degraded when local inhomogeneities consistently appear in every projection data.  This is usually caused by the impurities of the scintillation detector and can not be totally removed with the flat-field correction. These measurement artifacts usually stand out as vertical stripes in sinograms and are transformed to reconstructions as ring shaped artifacts. The process of clearing these artifacts are called as the ring-removal. 

There are numerous ways to correct these effects. The easiest and computationally most effective version is the median filtering along the sinogram. Median filtering works nicely without compromising reconstruction quality if the stripes are a few pixel width. One of the most powerful methods is the Wavelet-Fourier method which exploits the appearance of the 

\subsubsection{Phase retrieval}

Single-step methods. 

Touch maybe briefly multi-energy approaches with energy-selective measurements.


\subsubsection{Registration}

Data fusion: Local tomography. 

Phase-correlation: Correction of wabbling in images. Alignment for multi-step phase retrieval.

A 180 degrees rotation of the sample is generally sufficient to efficiently solve the reconstruction problem. However for some samples, especially when the sample size is larger than the field of view of the detector, a  rotation of 360 degrees can be used as an option for data acquisition. 

\subsection{Reconstruction}

Determination of center of rotation.

Gridrec. ART. 

\subsection{Post reconstruction}

??

\subsection{Storing Data}

Formats supported. Many are happy with TIFF. 

Explain storing provenance and its importance.

\section{Discussions}

Wrap the important points, vision and aims and conclude.

\appendix
\section{Appendix title}

Appendix text.

     % Acknowledgements come after the appendices

\ack{Acknowledgements}

Work supported by U.S. Department of Energy, Office of Science, under Contract No. XXX.

     % References are at the end of the document, between \begin{references}
     % and \end{references} tags. Each reference is in a \reference entry.

\referencelist[tomopy]

     %-------------------------------------------------------------------------
     % TABLES AND FIGURES SHOULD BE INSERTED AFTER THE MAIN BODY OF THE TEXT
     %-------------------------------------------------------------------------

 

\end{document}                    % DO NOT DELETE THIS LINE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

